<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Inconsciente Lunfardo por J. Abraham Muñoz Bravo - Un análisis filosófico del lunfardo como síntesis de las grandes corrientes occidentales">
    <title>Inconsciente Lunfardo (v. 1.0) - J. Abraham Muñoz Bravo</title>
    <!-- Preload critical fonts -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&family=Roboto:wght@300;400;500&display=swap" as="style">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700&family=Roboto:wght@300;400;500&display=swap">
    <style>
        :root {
            --primary-color: #c89a9e;
            --secondary-color: #a67f83;
            --background-color: #f5f1f2;
            --text-color: #333;
            --light-color: #fff;
            --paypal-yellow: #ffb700;
            --paypal-blue: #0070e0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* Modificación con fuente con serifa */
        body {
            font-family: 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-color);
        }
        
        /* Aplicar fuente con serifa a los títulos */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Merriweather', Georgia, serif;
            font-weight: 300;
        }
        
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header styles */
        header {
            padding: 2rem 0;
            text-align: center;
        }
        
        .hero {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4rem;
            padding: 5rem 1rem;
        }
        
        @media (min-width: 768px) {
            .hero {
                flex-direction: row;
                text-align: left;
            }
        }
        
        .book-cover {
            width: 350px;
            height: 525px;
            border-radius: 5px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
            overflow: hidden;
            perspective: 1000px;
            margin: 0 auto;
        }
        
        .book-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }
        
        .book-cover:hover .book-inner {
            transform: rotateY(180deg);
        }
        
        .book-front, .book-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .book-front {
            color: black;
        }
        
        .book-back {
            transform: rotateY(180deg);
        }
        
        .book-front img, .book-back img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .hero-content {
            max-width: 500px;
        }
        
        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1.5rem;
            font-weight: 300;
            color: var(--secondary-color);
        }
        
        .hero p {
            font-size: 1.1rem;
            margin-bottom: 2.5rem;
            line-height: 1.8;
        }
        
        .author-name {
            font-style: italic;
            color: var(--secondary-color);
            margin-bottom: 2rem;
        }
        
        /* Button styles */
        .btn-container {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 30px;
            background-color: var(--primary-color);
            color: var(--light-color);
            text-decoration: none;
            border-radius: 30px;
            font-weight: 500;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            letter-spacing: 0.5px;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            background-color: var(--secondary-color);
        }
        
        .btn-secondary {
            background-color: transparent;
            color: var(--secondary-color);
            border: 1px solid var(--secondary-color);
        }
        
        .btn-secondary:hover {
            background-color: var(--secondary-color);
            color: var(--light-color);
        }
        
        /* Footer */
        footer {
            background-color: var(--secondary-color);
            color: var(--light-color);
            padding: 2rem 0;
            text-align: center;
            margin-top: 5rem;
        }
        
        .social-links {
            margin-top: 1.5rem;
            display: flex;
            justify-content: center;
        }
        
        .youtube-link {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            background-color: #FF0000;
            border-radius: 50%;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .youtube-link:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 100;
            overflow: auto;
        }
        
        .modal-content {
            background-color: var(--light-color);
            margin: 10% auto;
            padding: 2.5rem;
            width: 90%;
            max-width: 500px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        /* Form styles */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--secondary-color);
        }
        
        input, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        /* Success message */
        .success-message {
            background-color: #d4edda;
            color: #155724;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 5px;
            display: none;
        }
        
        /* Download link */
        .download-link {
            background-color: rgba(200, 154, 158, 0.1);
            color: var(--secondary-color);
            padding: 2rem;
            margin: 3rem auto;
            border-radius: 10px;
            text-align: center;
            display: none;
            max-width: 600px;
        }
        
        .download-link a {
            color: var(--primary-color);
            font-weight: bold;
            text-decoration: none;
        }
        
        .download-link a:hover {
            text-decoration: underline;
        }
        
        /* Media Section Styles */
        .media-section {
            padding: 5rem 0;
            background-color: rgba(200, 154, 158, 0.05);
        }
        
        .media-section h2 {
            text-align: center;
            margin-bottom: 2.5rem;
            font-weight: 300;
            color: var(--secondary-color);
            font-size: 2rem;
        }
        
        .video-container {
            margin-bottom: 5rem;
        }
        
        .responsive-video {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            height: 0;
            overflow: hidden;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
            border-radius: 10px;
        }
        
        .responsive-video iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 10px;
        }
        
        .linkedin-post {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .post-container {
            background-color: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
            margin-bottom: 2rem;
        }
        
        .post-container:hover {
            transform: translateY(-5px);
        }
        
        .post-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .profile-img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-right: 1rem;
        }
        
        .post-author h3 {
            margin: 0;
            color: var(--text-color);
            font-size: 1.1rem;
        }
        
        .post-author p {
            margin: 0;
            color: #666;
            font-size: 0.9rem;
        }
        
        .post-content p {
            line-height: 1.8;
            margin-bottom: 1.5rem;
            color: var(--text-color);
        }
        
        /* Optimizaciones adicionales para rendimiento */
        img, svg {
            max-width: 100%;
            height: auto;
        }
        
        /* Destacar el enlace de LinkedIn de Ezequiel Murina */
        .linkedin-link {
            display: inline-block;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 0;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .linkedin-link:hover {
            color: var(--secondary-color);
        }
        
        .linkedin-link:after {
            content: '';
            position: absolute;
            width: 100%;
            height: 2px;
            bottom: 0;
            left: 0;
            background-color: var(--primary-color);
            transform: scaleX(0);
            transform-origin: bottom right;
            transition: transform 0.3s ease;
        }
        
        .linkedin-link:hover:after {
            transform: scaleX(1);
            transform-origin: bottom left;
        }
        
        @media (max-width: 768px) {
            .post-container {
                padding: 1.5rem;
            }
        }
        
        /* Author Section Styles */
        .author-section {
            padding: 5rem 0;
            background-color: rgba(166, 127, 131, 0.05);
        }
        
        .author-section h2 {
            text-align: center;
            margin-bottom: 3rem;
            font-weight: 300;
            color: var(--secondary-color);
            font-size: 2rem;
        }
        
        .author-profile {
            display: flex;
            flex-direction: column;
            max-width: 900px;
            margin: 0 auto;
        }
        
        @media (min-width: 768px) {
            .author-profile {
                flex-direction: row;
                gap: 3rem;
            }
        }
        
        .author-image {
            flex-shrink: 0;
            width: 300px;
            height: 300px;
            margin: 0 auto 2rem;
            overflow: hidden;
            border-radius: 5px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .author-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .author-bio {
            flex-grow: 1;
        }
        
        .author-bio h3 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--secondary-color);
            font-weight: 500;
        }
        
        .author-description p {
            margin-bottom: 1.5rem;
            line-height: 1.8;
            font-size: 0.9rem;
        }
        
        .author-resources {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(166, 127, 131, 0.2);
        }
        
        .author-resources h4 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: var(--secondary-color);
            font-weight: 500;
        }
        
        .author-resources ul {
            list-style: none;
            padding: 0;
        }
        
        .author-resources li {
            margin-bottom: 0.5rem;
        }
        
        .author-resources a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color 0.3s ease;
            font-weight: 500;
        }
        
        .author-resources a:hover {
            color: var(--secondary-color);
            text-decoration: underline;
        }
        
        /* Estilos para opciones de descarga */
        .download-options {
            margin: 2rem 0;
            display: none; /* Inicialmente oculto */
        }
        
        .download-option {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .download-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }
        
        .download-option h4 {
            margin-bottom: 1rem;
            color: var(--secondary-color);
        }
        
        /* Añadido: loader para indicar carga */
        .loader {
            display: none;
            border: 3px solid rgba(200, 154, 158, 0.3);
            border-radius: 50%;
            border-top: 3px solid var(--primary-color);
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Añadido: estilos para notificaciones de errores */
        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 5px;
            display: none;
        }

        /* Estilos para el formulario de email */
        .email-form {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .email-form h4 {
            margin-bottom: 1rem;
            color: var(--secondary-color);
        }

        .email-input {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .email-input input {
            flex-grow: 1;
        }

        .email-input button {
            flex-shrink: 0;
        }

        /* Estilo para la verificación de email */
        .invalid-email {
            border-color: #dc3545;
        }

        #emailError {
            color: #dc3545;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            display: none;
        }
        
        /* Estilos para el indicador de éxito */
        #successIndicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.3s;
            display: none;
        }
        
        /* Estilo para mensajes de email ya usado */
        #emailUsedError {
            background-color: #fff3cd;
            color: #856404;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 5px;
            display: none;
        }
        
        /* Estilos actualizados para botón de PayPal */
        .paypal-button {
            text-align: center;
            margin-top: 20px;
        }
        
        .modern-paypal-btn {
            background-color: #ffc439;
            color: #003087;
            padding: 15px 25px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.2rem;
            text-decoration: none;
            display: inline-block;
            border: none;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .modern-paypal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .payment-methods {
            display: flex;
            justify-content: center;
            margin-top: 10px;
            gap: 10px;
        }
        
        .payment-methods img {
            height: 30px;
            border-radius: 4px;
            border: 1px solid #e5e5e5;
            padding: 5px;
        }

        /* Estilos para el iframe de descarga */
        #downloadFrame {
            display: none;
            width: 0;
            height: 0;
            border: 0;
        }

        /* Mensaje de descarga */
        .download-message {
            display: none;
            background-color: #d4edda;
            color: #155724;
            padding: 1.5rem;
            margin: 1rem 0;
            border-radius: 5px;
            text-align: center;
        }

        .download-message svg {
            margin-bottom: 0.5rem;
        }

        /* Enlaces de descarga directa */
        .direct-download-link {
            display: none;
            margin-top: 1rem;
            text-align: center;
        }

        .direct-download-link a {
            color: #155724;
            text-decoration: underline;
        }
        
        /* Estilo para panel de debug */
        #debugPanel {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 9999;
            display: none;
            max-width: 300px;
        }
    </style>
</head>
<body>
    <!-- Header section -->
    <header>
        <div class="container">
            <!-- Minimalist header with no navigation -->
        </div>
    </header>
    
    <!-- Hero section -->
    <section class="hero">
        <div class="book-cover">
            <div class="book-inner">
                <div class="book-front">
                    <img src="portada.jpg" alt="Inconsciente Lunfardo by J. Abraham Muñoz Bravo" loading="eager">
                </div>
                <div class="book-back">
                    <img src="contraportada.jpg" alt="Contraportada - Inconsciente Lunfardo" loading="lazy">
                </div>
            </div>
        </div>
        <div class="hero-content">
            <h1>Inconsciente Lunfardo</h1>
            <div class="author-name">J. Abraham Muñoz Bravo</div>
            <p>La modernidad cristalizada en Argentina: un análisis filosófico que revela cómo el lunfardo, lejos de ser simple jerga, constituye la síntesis única de las grandes corrientes occidentales—Marx, Nietzsche, Freud—y amalgama las teorías de Hegel y Lacan de manera singular. Una mirada reveladora que desafía las narrativas convencionales sobre el desarrollo cultural global.</p>
            <div class="btn-container">
                <button class="btn" id="downloadBtn" aria-label="Descargar libro gratis">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px; vertical-align: -3px;">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="12" y1="18" x2="12" y2="12"></line>
                        <line x1="9" y1="15" x2="15" y2="15"></line>
                    </svg>
                    Descarga Gratuita
                </button>
                <button class="btn btn-secondary" id="buyBtn" aria-label="Comprar libro">Comprar Impreso - €19.99</button>
            </div>
        </div>
    </section>
    
    <!-- Media Section -->
    <section class="media-section">
        <div class="container">
            <!-- Video Section -->
            <div class="video-container">
                <h2>Descubre más sobre el libro</h2>
                <div class="responsive-video">
                    <iframe width="560" height="315" src="https://www.youtube.com/embed/Si5KjH_tiFI?start=2099" 
                            title="Inconsciente Lunfardo" 
                            frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            loading="lazy"
                            allowfullscreen>
                    </iframe>
                </div>
            </div>
            
            <!-- LinkedIn Post -->
            <div class="linkedin-post">
                <h2>Lo que dicen del libro</h2>
                <div class="post-container">
                    <div class="post-header">
                        <div class="profile-img" style="background-color: #a67f83; display: flex; justify-content: center; align-items: center;">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="36" height="36" fill="#ffffff">
                                <path d="M12 12C14.21 12 16 10.21 16 8C16 5.79 14.21 4 12 4C9.79 4 8 5.79 8 8C8 10.21 9.79 12 12 12ZM12 14C9.33 14 4 15.34 4 18V20H20V18C20 15.34 14.67 14 12 14Z"/>
                            </svg>
                        </div>
                        <div class="post-author">
                            <h3>Ezequiel Murina</h3>
                            <p>Físico cuántico</p>
                        </div>
                    </div>
                    <div class="post-content">
                        <p>"Inconsciente Lunfardo - J. Abraham Muñoz Bravo presenta una exploración fascinante del inconsciente colectivo a través del prisma del lunfardo. Una lectura imprescindible para entender la intersección entre psicología y lenguaje."</p>
                        <a href="https://www.linkedin.com/posts/ezequielmurina_inconsciente-lunfardo-abraham-mu%C3%B1oz-bravo-activity-7290076382259269634-Hje3?utm_source=share&utm_medium=member_desktop" 
                           target="_blank" 
                           rel="noopener"
                           class="linkedin-link" 
                           style="font-weight: bold; font-size: 1.1rem; text-decoration: underline; display: block; margin-top: 1rem; padding: 10px; background-color: rgba(10, 102, 194, 0.1); border-radius: 8px; border-left: 4px solid #0A66C2; transition: all 0.3s ease;">
                           <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="#0A66C2" style="margin-right: 8px; vertical-align: -5px;">
                               <path d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"/>
                           </svg>
                           Ver publicación original en LinkedIn
                        </a>
                    </div>
                </div>
                
                <!-- Gustavo Dessal Review -->
                <div class="post-container">
                    <div class="post-header">
                        <div class="profile-img" style="background-color: #a67f83; display: flex; justify-content: center; align-items: center;">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="36" height="36" fill="#ffffff">
                                <path d="M12 12C14.21 12 16 10.21 16 8C16 5.79 14.21 4 12 4C9.79 4 8 5.79 8 8C8 10.21 9.79 12 12 12ZM12 14C9.33 14 4 15.34 4 18V20H20V18C20 15.34 14.67 14 12 14Z"/>
                            </svg>
                        </div>
                        <div class="post-author">
                            <h3>Gustavo Dessal</h3>
                            <p>Psicoanalista y Escritor</p>
                        </div>
                    </div>
                    <div class="post-content">
                        <p>"Un psicoanalista que aborda los efectos de la 'lalangue' en la configuración del sujeto del inconsciente. El estudio del lunfardo como 'lengua madre' da una idea de por qué la transferencia con el psicoanálisis es en la Argentina algo que ha modelado la cultura sin distinción entre derecha e izquierda. En otras palabras: el psicoanálisis como ideología que todos allí comparten."</p>
                    </div>
                </div>
                
                <!-- Shirley Sharon-Zisser Review -->
                <div class="post-container">
                    <div class="post-header">
                        <div class="profile-img" style="background-color: #a67f83; display: flex; justify-content: center; align-items: center;">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="36" height="36" fill="#ffffff">
                                <path d="M12,2C6.48,2,2,6.48,2,12c0,5.52,4.48,10,10,10s10-4.48,10-10C22,6.48,17.52,2,12,2z M12,6c1.93,0,3.5,1.57,3.5,3.5 S13.93,13,12,13s-3.5-1.57-3.5-3.5S10.07,6,12,6z M12,20c-2.03,0-4.43-0.82-6.14-2.88C7.55,15.8,9.68,15,12,15 s4.45,0.8,6.14,2.12C16.43,19.18,14.03,20,12,20z"/>
                                <path d="M12,11c-0.83,0-1.5-0.67-1.5-1.5c0-0.83,0.67-1.5,1.5-1.5s1.5,0.67,1.5,1.5C13.5,10.33,12.83,11,12,11z"/>
                                <path d="M12,11c0.83,0,1.5-0.67,1.5-1.5c0-0.83-0.67-1.5-1.5-1.5s-1.5,0.67-1.5,1.5C10.5,10.33,11.17,11,12,11z"/>
                                <path d="M11.55,14h0.9v-2.5c0-0.28-0.22-0.5-0.5-0.5h0c-0.28,0-0.5,0.22-0.5,0.5V14H11.55z"/>
                                <path d="M13.95,14h0.1c0.83,0,1.5-0.67,1.5-1.5V11h-1.5v1.5C14.05,13.33,14.01,13.66,13.95,14z"/>
                                <path d="M9.95,14h0.1c-0.05-0.34-0.1-0.67-0.1-1V11h-1.5v1.5C8.45,13.33,9.12,14,9.95,14z"/>
                            </svg>
                        </div>
                        <div class="post-author">
                            <h3>Shirley Sharon-Zisser</h3>
                            <p>Profesora en literatura comparativa, psicoanálisis freudo-lacaniano y experta semióloga</p>
                        </div>
                    </div>
                    <div class="post-content">
                        <p>"Brillante, preciso, elegante."</p>
                    </div>
                </div>
                
                <!-- Santiago Molina Ruiz Review -->
                <div class="post-container">
                    <div class="post-header">
                        <div class="profile-img" style="background-color: #a67f83; display: flex; justify-content: center; align-items: center;">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="36" height="36" fill="#ffffff">
                                <path d="M12 12C14.21 12 16 10.21 16 8C16 5.79 14.21 4 12 4C9.79 4 8 5.79 8 8C8 10.21 9.79 12 12 12ZM12 14C9.33 14 4 15.34 4 18V20H20V18C20 15.34 14.67 14 12 14Z"/>
                            </svg>
                        </div>
                        <div class="post-author">
                            <h3>Santiago Molina Ruiz</h3>
                            <p>Filósofo y Prologuista del libro</p>
                        </div>
                    </div>
                    <div class="post-content">
                        <p>"Complejo, atrevido, sofisticado e intempestivo en la medida en que pocos poseen la delicadeza de ver la historia pasar mientras está pasando. Abraham ha conseguido fijarse en los lentos pasos de la historia que sólo suelen entenderse con los años, con los procesos ya concluidos y cristalizados en la materia de los historiadores, que es la muerte."</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Author Section -->
    <section class="author-section">
        <div class="container">
            <h2>Sobre el autor</h2>
            <div class="author-profile">
                <div class="author-image">
                    <img src="autor.jpg" alt="J. Abraham Muñoz Bravo" loading="lazy">
                </div>
                <div class="author-bio">
                    <h3>J. Abraham Muñoz Bravo</h3>
                    <div class="author-description">
                        <p>En su "radiografía del arrabal", como el único freudiano ortodoxo e historiador universal de su generación - con Lacan en una mano y Hegel en la otra - Abraham Muñoz B. aplica la filosofía teórica contemporánea – realismo especulativo – y la praxis psicoanalítica a los misterios culturales de Argentina y descubre los pilares psicológicos, antropológicos y lingüísticos de la compleja capital de esta nación: Buenos Aires.</p>
                        
                        <p>Se enfoca en el estudio de la mente, centrándose en la convergencia entre lenguaje, cognición y genealogía de ideas. Su interés abarca el rol del filósofo como piedra angular de la sociedad, en el encaje entre teoría mediática y producción de conocimiento en general.</p>
                        
                        <p>Tras estudiar Filosofía y Psicología en Tel Aviv, Muñoz volvió a España para trabajar en La Emboscadura Editorial, curando el archivo multimedial de Antonio Escohotado. Esta labor, aun en YouTube arriesgando una hagiografía auto-inducida, le permitió antropologizar las secuelas del <em>Zeitgeist</em> hippie-ibicenco desde una óptica paradójicamente conservadora; pero su regreso a España, su sangre, unió esta iniciación en el pasaje forestal jüngeriano con el aprendizaje de filosofía en territorio ibérico, por españoles, en castellano, por primera vez.</p>
                        
                        <p>Impulsado por la insatisfacción con la instrucción recibida en su licenciatura, Muñoz desarrolla su teorización filosófica con alma enciclopédica en su (cripto-)escritura; aun velada por lo que achaca él a "una providencial desidia e incendios ciberespaciales". En su segundo año de carrera, se encontró con una profesora erudita, "el único docente con una visión de 360 grados de la historia de las ideas" que le reveló el mundo del psicoanálisis. Esto transformó radicalmente su pensamiento sobre el lenguaje, pasando de un enredo con las confusiones lingüísticas a hacer un giro quirúrgico de la observación hacia la función en sí del habla - como un espejismo persistente de la mismidad - que refleja la inconsciencia de los instintos de nuestra dimensión animal. El método psicoanalítico, que exige conocimientos de diversas fuentes, se alineó bien con la actitud interdisciplinaria de Muñoz. Así, continuará "aportando valor" dice él, "como lacaniano fascinado por el lenguaje, como filósofo consciente de la complejidad de la mente y como estudioso interesado en los gigantes intelectuales del pasado".</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Free PDF Download Section (hidden initially) -->
    <div class="download-link" id="downloadSection">
        <h3>¡Gracias por tu interés!</h3>
        <p>Para obtener tu PDF gratuito, necesitamos tu dirección de correo electrónico:</p>
        
        <!-- Formulario de email -->
        <div class="email-form">
            <h4>Ingresa tu email para acceder a la descarga</h4>
            <p>Necesitamos tu correo para habilitar la descarga inmediata a tu dispositivo.</p>
            
            <div class="email-input">
                <input type="email" id="userEmail" placeholder="Tu correo electrónico" required>
                <button class="btn" id="validateEmailBtn">Validar</button>
            </div>
            <div id="emailError">Por favor, introduce un correo electrónico válido.</div>
        </div>
        
        <div class="download-options" id="downloadOptions">
            <!-- Opción: Descarga directa -->
            <div class="download-option">
                <h4>Descarga directa</h4>
                <p>Descarga el PDF directamente a tu dispositivo:</p>
                <div class="loader" id="directDownloadLoader"></div>
                <div class="error-message" id="directDownloadError">Ha ocurrido un error en la descarga. Por favor intenta nuevamente.</div>
                <div class="error-message" id="emailUsedError">Este email ya ha sido utilizado para descargar el libro. Por favor, introduce otro email.</div>
                
                <a href="#" 
                   class="btn" 
                   id="directDownloadBtn" 
                   download="Inconsciente-Lunfardo.pdf">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px; vertical-align: -3px;">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Descargar PDF
                </a>
                
                <!-- Enlace de descarga directo (alternativa) -->
                <div class="direct-download-link" id="directDownloadLink">
                    <p>Si la descarga no comienza automáticamente, <a href="muestra-inconsciente-lunfardo.pdf" download="Inconsciente-Lunfardo.pdf">haz clic aquí</a></p>
                </div>
                
                <!-- Mensaje de descarga exitosa -->
                <div class="download-message" id="downloadSuccess">
                    <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#155724" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin: 0 auto 15px auto; display: block;">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>
                    <h4 style="color: #155724; text-align: center; margin-bottom: 10px; font-size: 1.4rem;">¡Tu descarga ha comenzado!</h4>
                    <p style="text-align: center;">El archivo se está descargando a tu dispositivo.</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Footer -->
    <footer>
        <div class="container">
            <p>&copy; 2025 J. Abraham Muñoz Bravo. Todos los derechos reservados.</p>
            <div class="social-links">
                <a href="https://www.youtube.com/@PSITEKPHI/videos" target="_blank" rel="noopener" class="youtube-link" aria-label="Canal de YouTube">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#ffffff">
                        <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
                    </svg>
                </a>
            </div>
        </div>
    </footer>
    
    <!-- Buy Modal -->
    <div class="modal" id="buyModal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Comprar "Inconsciente Lunfardo"</h2>
            <p>Por favor, completa el formulario y haz clic en el botón de PayPal para finalizar tu compra:</p>
            
            <div class="success-message" id="successMessage">
                ¡Gracias por tu compra! Recibirás tu libro en breve.
                Nos pondremos en contacto contigo desde psitekphi@gmail.com para coordinar el envío.
            </div>
            
            <div class="error-message" id="purchaseError">
                Ha ocurrido un error en el proceso de compra. Por favor, inténtalo de nuevo o contacta con nosotros en psitekphi@gmail.com.
            </div>
            
            <!-- Formulario de compra directo -->
            <form id="paypalForm" action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
                <input type="hidden" name="cmd" value="_xclick">
                <input type="hidden" name="business" value="psitekphi@gmail.com">
                <input type="hidden" name="lc" value="ES">
                <input type="hidden" name="item_name" value="Libro Inconsciente Lunfardo">
                <input type="hidden" name="amount" value="19.99">
                <input type="hidden" name="currency_code" value="EUR">
                <input type="hidden" name="button_subtype" value="services">
                <input type="hidden" name="no_shipping" value="1">
                <input type="hidden" name="no_note" value="0">
                <input type="hidden" name="tax_rate" value="0">
                <input type="hidden" name="shipping" value="0">
                <input type="hidden" name="bn" value="PP-BuyNowBF:btn_buynowCC_LG.gif:NonHosted">
                <input type="hidden" name="custom" id="paypalCustomField">
                <input type="hidden" name="return" value="#compra-completada">
                <input type="hidden" name="cancel_return" value="#compra-cancelada">
                
                <div class="form-group">
                    <label for="name">Nombre Completo</label>
                    <input type="text" id="name" name="first_name" required>
                </div>
                
                <div class="form-group">
                    <label for="email">Correo Electrónico</label>
                    <input type="email" id="email" name="email" required>
                </div>
                
                <div class="form-group">
                    <label for="address">Dirección de Envío</label>
                    <textarea id="address" name="address1" rows="3" required></textarea>
                </div>
                
                <div class="form-group">
                    <label for="city">Ciudad</label>
                    <input type="text" id="city" name="city" required>
                </div>
                
                <div class="form-group">
                    <label for="postalCode">Código Postal</label>
                    <input type="text" id="postalCode" name="zip" required>
                </div>
                
                <div class="form-group">
                    <label for="country">País</label>
                    <input type="text" id="country" name="country" required>
                </div>
                
                <!-- Botón moderno de PayPal -->
                <div class="paypal-button">
                    <button type="submit" class="modern-paypal-btn" onclick="return preparePayPalData();">
                        Comprar ahora con PayPal
                    </button>
                    <div class="payment-methods">
                        <img src="https://cdn.iconscout.com/icon/free/png-256/free-maestro-5-675724.png" alt="Maestro">
                        <img src="https://cdn.iconscout.com/icon/free/png-256/free-visa-3-226460.png" alt="Visa">
                        <img src="https://cdn.iconscout.com/icon/free/png-256/free-mastercard-3-226455.png" alt="Mastercard">
                        <img src="https://cdn.iconscout.com/icon/free/png-256/free-american-express-51-675724.png" alt="American Express">
                        <img src="https://cdn.iconscout.com/icon/free/png-256/free-apple-pay-5-675707.png" alt="Apple Pay">
                        <img src="https://cdn.iconscout.com/icon/free/png-256/free-paypal-54-675727.png" alt="PayPal">
                    </div>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Elemento para mostrar mensajes de éxito -->
    <div id="successIndicator"></div>
    
    <!-- Panel de debug (añadido para pruebas) -->
    <div id="debugPanel"></div>
    
    <script>
        // URL del script del Apps Script implementado como aplicación web
        const GOOGLE_SHEET_ENDPOINT = 'https://script.google.com/macros/s/AKfycbxKMUAaDmP-511XRfilb0sX6ZkN6nNS1uyUlrsm__JMEVLxw0TgB6JFE18ugmBBnbkeLQ/exec';
        
        // Función para validar email
        function isValidEmail(email) {
            const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return regex.test(email);
        }
        
        // Función para mostrar indicador de éxito
        function showSuccessIndicator(message) {
            let successIndicator = document.getElementById('successIndicator');
            
            successIndicator.textContent = message;
            successIndicator.style.display = 'block';
            
            setTimeout(() => {
                successIndicator.style.opacity = '1';
                setTimeout(() => {
                    successIndicator.style.opacity = '0';
                    setTimeout(() => {
                        successIndicator.style.display = 'none';
                    }, 300);
                }, 2000);
            }, 100);
        }
        
        // Verificar si el email ya ha sido usado para una descarga
        function isEmailUsed(email) {
            try {
                const usedEmails = JSON.parse(localStorage.getItem('usedEmails') || '[]');
                return usedEmails.includes(email);
            } catch (e) {
                console.error('Error checking used emails:', e);
                return false; // En caso de error, permitimos la descarga
            }
        }
        
        // Registrar un email como usado
        function markEmailAsUsed(email) {
            try {
                const usedEmails = JSON.parse(localStorage.getItem('usedEmails') || '[]');
                if (!usedEmails.includes(email)) {
                    usedEmails.push(email);
                    localStorage.setItem('usedEmails', JSON.stringify(usedEmails));
                }
            } catch (e) {
                console.error('Error marking email as used:', e);
            }
        }
        
        // Función para obtener dirección IP (aproximada)
        async function getIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                console.error('Error al obtener IP:', error);
                return 'unknown';
            }
        }
        
        // Sistema de registro con reintentos
        async function logActionWithRetry(params, maxRetries = 3, currentRetry = 0) {
            try {
                // Añadir timestamp para evitar caché
                params.append('cacheBuster', new Date().getTime());
                
                // Intentar con fetch (más moderno)
                const response = await fetch(`${GOOGLE_SHEET_ENDPOINT}?${params.toString()}`);
                
                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }
                
                const data = await response.json();
                return data;
            } catch (error) {
                console.warn(`Intento ${currentRetry + 1} fallido:`, error);
                
                // Si aún tenemos reintentos disponibles
                if (currentRetry < maxRetries) {
                    console.log(`Reintentando (${currentRetry + 1}/${maxRetries})...`);
                    
                    // Esperar un tiempo antes de reintentar (aumentando exponencialmente)
                    const delay = Math.pow(2, currentRetry) * 1000;
                    
                    return new Promise(resolve => {
                        setTimeout(() => {
                            resolve(logActionWithRetry(params, maxRetries, currentRetry + 1));
                        }, delay);
                    });
                }
                
                // Método alternativo: imagen (funciona incluso con bloqueo de scripts)
                try {
                    const imgFallback = new Image();
                    imgFallback.src = `${GOOGLE_SHEET_ENDPOINT}?${params.toString()}`;
                    return { status: "pending", method: "img-fallback" };
                } catch (imgError) {
                    console.error('Todos los intentos fallaron:', imgError);
                    throw error; // Lanzar el error original
                }
            }
        }
        
        // Guardar acciones de respaldo
        function saveBackupAction(action, email, additionalData = {}) {
            try {
                const backupKey = `sheets_backup_${action}_${Date.now()}`;
                const backupData = {
                    action,
                    email,
                    timestamp: new Date().toISOString(),
                    userAgent: navigator.userAgent,
                    ...additionalData
                };
                
                // Guardar en localStorage
                localStorage.setItem(backupKey, JSON.stringify(backupData));
                console.log('Datos de respaldo guardados:', backupKey);
                
                return backupKey;
            } catch (e) {
                console.error('Error al guardar datos de respaldo:', e);
                return null;
            }
        }
        
        // Procesar respaldos pendientes (llamado periódicamente)
        function processBackups() {
            const MAX_RETRY_AGE_HOURS = 24; // Descartar respaldos más antiguos de 24 horas
            const now = new Date();
            
            try {
                let pendingBackups = 0;
                
                Object.keys(localStorage).forEach(key => {
                    if (key.startsWith('sheets_backup_')) {
                        pendingBackups++;
                        
                        try {
                            // Obtener y analizar los datos de respaldo
                            const backupData = JSON.parse(localStorage.getItem(key));
                            
                            // Verificar la antigüedad del respaldo
                            const backupTime = new Date(backupData.timestamp || 0);
                            const ageHours = (now - backupTime) / (1000 * 60 * 60);
                            
                            if (ageHours > MAX_RETRY_AGE_HOURS) {
                                // Descartar respaldos antiguos
                                console.log(`Descartando respaldo antiguo (${ageHours.toFixed(2)} horas):`, key);
                                localStorage.removeItem(key);
                                return;
                            }
                            
                            console.log('Procesando respaldo pendiente:', key);
                            
                            // Preparar parámetros para reenvío
                            getIP().then(ip => {
                                const params = new URLSearchParams({
                                    email: backupData.email || 'desconocido',
                                    action: `REINTENTO: ${backupData.action}`,
                                    timestamp: backupData.timestamp,
                                    retry_timestamp: now.toISOString(),
                                    userAgent: backupData.userAgent || navigator.userAgent,
                                    ip: ip,
                                    extraData: JSON.stringify(backupData)
                                });
                                
                                // Intentar enviar
                                fetch(`${GOOGLE_SHEET_ENDPOINT}?${params.toString()}`)
                                    .then(response => {
                                        if (!response.ok) throw new Error('Respuesta no exitosa');
                                        return response.json();
                                    })
                                    .then(data => {
                                        console.log('Reenvío exitoso:', data);
                                        // Eliminar el respaldo una vez enviado correctamente
                                        localStorage.removeItem(key);
                                    })
                                    .catch(error => {
                                        console.warn('Error en reenvío, se mantendrá para reintentar más tarde:', error);
                                    });
                            });
                            
                        } catch (parseError) {
                            console.error('Error al procesar respaldo:', parseError);
                            // Eliminar respaldos corruptos
                            localStorage.removeItem(key);
                        }
                    }
                });
                
                if (pendingBackups > 0) {
                    console.log(`Procesando ${pendingBackups} respaldos pendientes...`);
                }
            } catch (e) {
                console.error('Error al verificar respaldos:', e);
            }
        }
        
        // Función para registrar descargas en Google Sheets
        async function downloadPDF(email) {
            // Make sure email isn't empty and is properly trimmed
            email = (email || "").trim();
            console.log(`Processing download for email: "${email}"`);
            
            // Ocultar mensajes anteriores
            document.getElementById('emailUsedError').style.display = 'none';
            document.getElementById('directDownloadError').style.display = 'none';
            
            if (isEmailUsed(email)) {
                document.getElementById('emailUsedError').style.display = 'block';
                return false;
            }
            
            document.getElementById('directDownloadLoader').style.display = 'block';
            
            try {
                // 1. Iniciar la descarga del archivo
                const link = document.createElement('a');
                link.href = 'muestra-inconsciente-lunfardo.pdf';
                link.download = 'Inconsciente-Lunfardo.pdf';
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // 2. Registrar la descarga en Google Sheets usando AMBOS métodos
                const ip = await getIP();
                const timestamp = new Date().toISOString();
                
                // MÉTODO 1: Directo por URL (más efectivo para cross-domain)
                const directUrl = `${GOOGLE_SHEET_ENDPOINT}?` + 
                    `email=${encodeURIComponent(email)}` + 
                    `&action=${encodeURIComponent('Descarga PDF')}` + 
                    `&timestamp=${encodeURIComponent(timestamp)}` + 
                    `&userAgent=${encodeURIComponent(navigator.userAgent)}` + 
                    `&ip=${encodeURIComponent(ip || 'desconocido')}`;
                
                console.log('Enviando datos a Google Sheets por URL directa:', directUrl);
                
                // Crear imagen para enviar datos (método cross-domain que funciona siempre)
                const img = new Image();
                img.onload = () => console.log('Registro via imagen exitoso');
                img.onerror = () => console.log('Imagen falló visualmente pero la solicitud fue enviada');
                img.src = directUrl;
                
                // MÉTODO 2: Original (URLSearchParams con fetch)
                const params = new URLSearchParams({
                    email: email,
                    action: 'Descarga PDF',
                    timestamp: timestamp,
                    userAgent: navigator.userAgent,
                    ip: ip,
                    extraData: JSON.stringify({source: 'website', device: navigator.platform})
                });
                
                // Intentar método original también
                fetch(`${GOOGLE_SHEET_ENDPOINT}?${params.toString()}`)
                    .then(response => {
                        console.log('Respuesta de fetch:', response);
                        return response.json();
                    })
                    .then(data => {
                        console.log('Descarga registrada correctamente (método fetch):', data);
                        markEmailAsUsed(email);
                    })
                    .catch(error => {
                        console.warn('Error en método fetch, pero la imagen debería funcionar:', error);
                        // La imagen debería haber funcionado, así que seguimos
                        markEmailAsUsed(email);
                    });
                
                // 3. Mostrar mensaje de éxito inmediatamente
                document.getElementById('directDownloadLoader').style.display = 'none';
                document.getElementById('downloadSuccess').style.display = 'block';
                document.getElementById('directDownloadBtn').style.display = 'none';
                document.getElementById('directDownloadLink').style.display = 'block';
                
                return true;
            } catch (error) {
                console.error('Error en el proceso de descarga:', error);
                document.getElementById('directDownloadLoader').style.display = 'none';
                document.getElementById('directDownloadError').style.display = 'block';
                return false;
            }
        }
        
        // Función para preparar datos de PayPal
        function preparePayPalData() {
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const address = document.getElementById('address').value;
            const city = document.getElementById('city').value;
            const postalCode = document.getElementById('postalCode').value;
            const country = document.getElementById('country').value;
            
            // Validar datos básicos
            if (!name || !email || !address || !city || !postalCode || !country) {
                alert('Por favor, completa todos los campos del formulario antes de continuar.');
                return false;
            }
            
            if (!isValidEmail(email)) {
                alert('Por favor, introduce un correo electrónico válido.');
                return false;
            }
            
            // Datos para PayPal
            const customerData = JSON.stringify({
                name, email, address, city, postalCode, country,
                timestamp: new Date().toISOString()
            });
            
            document.getElementById('paypalCustomField').value = customerData;
            
            // Registrar la compra en nuestro sistema
            getIP().then(ip => {
                const params = new URLSearchParams({
                    email: email,
                    action: 'Compra libro',
                    timestamp: new Date().toISOString(),
                    userAgent: navigator.userAgent,
                    ip: ip,
                    extraData: JSON.stringify({
                        nombre: name,
                        direccion: address,
                        ciudad: city,
                        codigo_postal: postalCode,
                        pais: country,
                        precio: '€19.99'
                    })
                });
                
                // Enviar los datos
                logActionWithRetry(params)
                    .then(success => {
                        console.log('Compra registrada correctamente:', success);
                    })
                    .catch(error => {
                        console.error('Error al registrar compra:', error);
                        // Guardar en localStorage como respaldo
                        saveBackupAction('purchase', email, {name, address, city, postalCode, country});
                    });
            });
            
            // Mostrar mensaje de confirmación
            showSuccessIndicator('Procesando compra...');
            
            return true; // Continuar con el envío del formulario PayPal
        }
        
        // Añadir herramientas de depuración para pruebas
        function addDebugTools() {
            // Verificar si el URL tiene ?debug=true
            if (window.location.search.includes('debug=true')) {
                const debugPanel = document.getElementById('debugPanel');
                debugPanel.style.display = 'block';
                
                debugPanel.innerHTML = `
                    <h4 style="margin-top: 0; margin-bottom: 10px; color: #333;">Herramientas de Depuración</h4>
                    <p style="font-size: 12px; margin-bottom: 15px;">Prueba la conexión con Google Sheets:</p>
                    <button id="testSheetsBtn" style="background: #c89a9e; color: white; border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 14px;">
                        Probar Conexión
                    </button>
                    <div id="testResult" style="margin-top: 10px; font-size: 12px; color: #333; display: none;"></div>
                `;
                
                // Configurar botón de prueba
                document.getElementById('testSheetsBtn').addEventListener('click', function() {
                    const resultDiv = document.getElementById('testResult');
                    resultDiv.style.display = 'block';
                    resultDiv.innerHTML = 'Enviando solicitud de prueba...';
                    
                    const testEmail = "test-" + Math.floor(Math.random() * 10000) + "@example.com";
                    const testUrl = `${GOOGLE_SHEET_ENDPOINT}?email=${encodeURIComponent(testEmail)}&action=Debug Test&timestamp=${encodeURIComponent(new Date().toISOString())}`;
                    
                    console.log(`Probando conexión usando: ${testUrl}`);
                    
                    // Método 1: Imagen (más confiable para cross-origin)
                    const img = new Image();
                    img.onload = () => {
                        resultDiv.innerHTML += '<br>✅ Método imagen exitoso';
                        resultDiv.style.color = '#155724';
                    };
                    img.onerror = () => {
                        resultDiv.innerHTML += '<br>⚠️ Error en imagen pero solicitud enviada';
                        resultDiv.style.color = '#856404';
                    };
                    img.src = testUrl;
                    
                    // Método 2: Fetch con no-cors
                    fetch(testUrl, { mode: 'no-cors' })
                        .then(() => {
                            resultDiv.innerHTML += '<br>✅ Fetch completado';
                            resultDiv.style.color = '#155724';
                        })
                        .catch(err => {
                            resultDiv.innerHTML += '<br>❌ Fetch falló: ' + err.message;
                            resultDiv.style.color = '#721c24';
                        });
                    
                    resultDiv.innerHTML += '<br><br>👉 Revisa tu Google Sheet para email: ' + testEmail;
                });
            }
        }
        
        // Configuración de eventos cuando el DOM esté cargado
        document.addEventListener('DOMContentLoaded', function() {
            // Referencias a elementos DOM
            const elements = {
                downloadBtn: document.getElementById('downloadBtn'),
                buyBtn: document.getElementById('buyBtn'),
                buyModal: document.getElementById('buyModal'),
                closeBtn: document.querySelector('.close'),
                downloadSection: document.getElementById('downloadSection'),
                validateEmailBtn: document.getElementById('validateEmailBtn'),
                userEmail: document.getElementById('userEmail'),
                emailError: document.getElementById('emailError'),
                downloadOptions: document.getElementById('downloadOptions'),
                directDownloadBtn: document.getElementById('directDownloadBtn')
            };
            
            // Evento para mostrar sección de descarga
            if (elements.downloadBtn) {
                elements.downloadBtn.addEventListener('click', function() {
                    if (elements.downloadSection) {
                        elements.downloadSection.style.display = 'block';
                        elements.downloadSection.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            }
            
            // Evento para validar email
            if (elements.validateEmailBtn) {
                elements.validateEmailBtn.addEventListener('click', function() {
                    const email = elements.userEmail.value.trim();
                    
                    if (isValidEmail(email)) {
                        // Email válido - mostrar opciones de descarga
                        elements.userEmail.classList.remove('invalid-email');
                        elements.emailError.style.display = 'none';
                        
                        // Verificar si el email ya fue usado
                        if (isEmailUsed(email)) {
                            document.getElementById('emailUsedError').style.display = 'block';
                            elements.downloadOptions.style.display = 'block';
                            document.getElementById('directDownloadBtn').style.opacity = '0.5';
                            document.getElementById('directDownloadBtn').style.pointerEvents = 'none';
                        } else {
                            document.getElementById('emailUsedError').style.display = 'none';
                            elements.downloadOptions.style.display = 'block';
                            document.getElementById('directDownloadBtn').style.opacity = '1';
                            document.getElementById('directDownloadBtn').style.pointerEvents = 'auto';
                            document.getElementById('downloadSuccess').style.display = 'none';
                        }
                        
                        // Mostrar opciones de descarga
                        elements.downloadOptions.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    } else {
                        // Email inválido
                        elements.userEmail.classList.add('invalid-email');
                        elements.emailError.style.display = 'block';
                        elements.downloadOptions.style.display = 'none';
                    }
                });
            }
            
            // Configurar el botón de descarga directa
            if (elements.directDownloadBtn) {
                elements.directDownloadBtn.addEventListener('click', function(event) {
                    event.preventDefault();
                    const email = document.getElementById('userEmail').value.trim();
                    downloadPDF(email);
                });
            }
            
            // Evento para mostrar modal de compra
            if (elements.buyBtn) {
                elements.buyBtn.addEventListener('click', function() {
                    if (elements.buyModal) {
                        elements.buyModal.style.display = 'block';
                    }
                });
            }
            
            // Evento para cerrar modal
            if (elements.closeBtn) {
                elements.closeBtn.addEventListener('click', function() {
                    if (elements.buyModal) {
                        elements.buyModal.style.display = 'none';
                    }
                });
            }
            
            // Cerrar modal al hacer clic fuera
            window.addEventListener('click', function(event) {
                if (elements.buyModal && event.target == elements.buyModal) {
                    elements.buyModal.style.display = 'none';
                }
            });
            
            // Verificar si la URL tiene hash de descarga completa
            if (window.location.hash === '#download-complete') {
                showSuccessIndicator('¡Descarga completada con éxito!');
                window.location.hash = '';
            }
            
            // Verificar si la URL tiene hash de compra completada
            if (window.location.hash === '#compra-completada') {
                showSuccessIndicator('¡Compra realizada con éxito!');
                window.location.hash = '';
            }
            
            // Añadir herramientas de depuración
            addDebugTools();
            
            // Añade el procesamiento periódico de respaldos
            setInterval(processBackups, 60000); // Verificar cada minuto
            
            // Procesar respaldos inmediatamente al cargar
            setTimeout(processBackups, 5000);
        });
    </script>
</body>
</html>
